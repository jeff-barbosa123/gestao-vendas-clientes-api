{
  "openapi": "3.0.3",
  "info": {
    "title": "Gestão de Vendas e Clientes API",
    "version": "1.0.0",
    "description": "API Rest para gestão de vendas e clientes. Autenticação via JWT."
  },
  "servers": [
    { "url": "/api", "description": "API base" }
  ],
  "tags": [
    { "name": "Auth" },
    { "name": "Clientes" },
    { "name": "Produtos" },
    { "name": "Vendas" },
    { "name": "Relatórios" }
  ],
  "paths": {
    "/auth/login": {
      "post": {
        "tags": ["Auth"],
        "summary": "Realiza login e retorna token JWT",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AuthLoginRequest" }
            }
          }
        },
        "responses": {
          "200": { "description": "Login bem-sucedido", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AuthLoginResponse" } } } },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "description": "Acesso bloqueado por múltiplas tentativas" , "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/auth/logout": {
      "post": { "tags": ["Auth"], "summary": "Revoga o token atual", "responses": { "204": { "description": "Deslogado" } } }
    },
    "/customers": {
      "get": { "tags": ["Clientes"], "summary": "Lista clientes", "security": [{"bearerAuth":[]}], "responses": { "200": { "description": "Lista de clientes", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/Customer" } } } } }, "401": { "$ref": "#/components/responses/Unauthorized" } } },
      "post": { "tags": ["Clientes"], "summary": "Cria cliente", "security": [{"bearerAuth":[]}], "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CustomerCreate" } } } }, "responses": { "201": { "description": "Criado", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Customer" } } } }, "400": { "$ref": "#/components/responses/BadRequest" }, "409": { "$ref": "#/components/responses/Conflict" }, "401": { "$ref": "#/components/responses/Unauthorized" } } }
    },
    "/customers/{id}": {
      "get": { "tags": ["Clientes"], "summary": "Busca cliente por ID", "security": [{"bearerAuth":[]}], "parameters": [{"name":"id","in":"path","required":true,"schema":{"type":"string"}}], "responses": { "200": { "description": "Cliente", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Customer" } } } }, "404": { "$ref": "#/components/responses/NotFound" }, "401": { "$ref": "#/components/responses/Unauthorized" } } },
      "put": { "tags": ["Clientes"], "summary": "Atualiza cliente", "security": [{"bearerAuth":[]}], "parameters": [{"name":"id","in":"path","required":true,"schema":{"type":"string"}}], "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CustomerUpdate" } } } }, "responses": { "200": { "description": "Atualizado", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Customer" } } } }, "404": { "$ref": "#/components/responses/NotFound" }, "409": { "$ref": "#/components/responses/Conflict" }, "401": { "$ref": "#/components/responses/Unauthorized" } } },
      "delete": { "tags": ["Clientes"], "summary": "Remove cliente", "security": [{"bearerAuth":[]}], "parameters": [{"name":"id","in":"path","required":true,"schema":{"type":"string"}}], "responses": { "200": { "description": "Removido", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Customer" } } } }, "404": { "$ref": "#/components/responses/NotFound" }, "401": { "$ref": "#/components/responses/Unauthorized" } } }
    },
    "/products": {
      "get": { "tags": ["Produtos"], "summary": "Lista produtos", "security": [{"bearerAuth":[]}], "responses": { "200": { "description": "Lista de produtos", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/Product" } } } } }, "401": { "$ref": "#/components/responses/Unauthorized" } } },
      "post": { "tags": ["Produtos"], "summary": "Cria produto", "security": [{"bearerAuth":[]}], "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProductCreate" } } } }, "responses": { "201": { "description": "Criado", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Product" } } } }, "400": { "$ref": "#/components/responses/BadRequest" }, "401": { "$ref": "#/components/responses/Unauthorized" } } }
    },
    "/products/{id}": {
      "get": { "tags": ["Produtos"], "summary": "Busca produto por ID", "security": [{"bearerAuth":[]}], "parameters": [{"name":"id","in":"path","required":true,"schema":{"type":"string"}}], "responses": { "200": { "description": "Produto", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Product" } } } }, "404": { "$ref": "#/components/responses/NotFound" }, "401": { "$ref": "#/components/responses/Unauthorized" } } },
      "put": { "tags": ["Produtos"], "summary": "Atualiza produto", "security": [{"bearerAuth":[]}], "parameters": [{"name":"id","in":"path","required":true,"schema":{"type":"string"}}], "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProductUpdate" } } } }, "responses": { "200": { "description": "Atualizado", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Product" } } } }, "404": { "$ref": "#/components/responses/NotFound" }, "400": { "$ref": "#/components/responses/BadRequest" }, "401": { "$ref": "#/components/responses/Unauthorized" } } },
      "delete": { "tags": ["Produtos"], "summary": "Remove produto", "security": [{"bearerAuth":[]}], "parameters": [{"name":"id","in":"path","required":true,"schema":{"type":"string"}}], "responses": { "200": { "description": "Removido", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Product" } } } }, "404": { "$ref": "#/components/responses/NotFound" }, "401": { "$ref": "#/components/responses/Unauthorized" } } }
    },
    "/sales": {
      "get": { "tags": ["Vendas"], "summary": "Lista vendas", "security": [{"bearerAuth":[]}], "responses": { "200": { "description": "Lista de vendas", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/Sale" } } } } }, "401": { "$ref": "#/components/responses/Unauthorized" } } },
      "post": { "tags": ["Vendas"], "summary": "Cria venda (confirmada)", "security": [{"bearerAuth":[]}], "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SaleCreate" } } } }, "responses": { "201": { "description": "Criada", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Sale" } } } }, "400": { "$ref": "#/components/responses/BadRequest" }, "404": { "$ref": "#/components/responses/NotFound" }, "401": { "$ref": "#/components/responses/Unauthorized" } } }
    },
    "/sales/{id}": {
      "get": { "tags": ["Vendas"], "summary": "Busca venda por ID", "security": [{"bearerAuth":[]}], "parameters": [{"name":"id","in":"path","required":true,"schema":{"type":"string"}}], "responses": { "200": { "description": "Venda", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Sale" } } } }, "404": { "$ref": "#/components/responses/NotFound" }, "401": { "$ref": "#/components/responses/Unauthorized" } } },
      "put": { "tags": ["Vendas"], "summary": "Atualiza venda", "security": [{"bearerAuth":[]}], "parameters": [{"name":"id","in":"path","required":true,"schema":{"type":"string"}}], "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SaleUpdate" } } } }, "responses": { "200": { "description": "Atualizada", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Sale" } } } }, "404": { "$ref": "#/components/responses/NotFound" }, "422": { "$ref": "#/components/responses/Unprocessable" }, "401": { "$ref": "#/components/responses/Unauthorized" } } }
    },
    "/sales/{id}/cancel": {
      "post": { "tags": ["Vendas"], "summary": "Cancela a venda", "security": [{"bearerAuth":[]}], "parameters": [{"name":"id","in":"path","required":true,"schema":{"type":"string"}}], "responses": { "200": { "description": "Cancelada", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Sale" } } } }, "404": { "$ref": "#/components/responses/NotFound" }, "401": { "$ref": "#/components/responses/Unauthorized" } } }
    },
    "/reports/revenue": {
      "get": { "tags": ["Relatórios"], "summary": "Resumo de faturamento", "security": [{"bearerAuth":[]}], "parameters": [
        {"name":"start","in":"query","schema":{"type":"string","format":"date-time"}},
        {"name":"end","in":"query","schema":{"type":"string","format":"date-time"}},
        {"name":"breakdown","in":"query","schema":{"type":"string","enum":["total","day","week","month"]}}
      ], "responses": { "200": { "description": "Resumo de faturamento", "content": { "application/json": { "schema": { "oneOf": [ {"$ref": "#/components/schemas/RevenueTotal"}, {"type":"array","items":{"$ref":"#/components/schemas/RevenueRow"}} ] } } } }, "400": { "$ref": "#/components/responses/BadRequest" }, "401": { "$ref": "#/components/responses/Unauthorized" } } }
    },
    "/reports/revenue/export": {
      "get": { "tags": ["Relatórios"], "summary": "Exporta faturamento (csv/pdf)", "security": [{"bearerAuth":[]}], "parameters": [
        {"name":"start","in":"query","schema":{"type":"string","format":"date-time"}},
        {"name":"end","in":"query","schema":{"type":"string","format":"date-time"}},
        {"name":"breakdown","in":"query","schema":{"type":"string","enum":["total","day","week","month"]}},
        {"name":"format","in":"query","schema":{"type":"string","enum":["csv","pdf","excel"]}}
      ], "responses": { "200": { "description": "Arquivo de exportação" }, "400": { "$ref": "#/components/responses/BadRequest" }, "401": { "$ref": "#/components/responses/Unauthorized" } } }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": { "type": "http", "scheme": "bearer", "bearerFormat": "JWT" }
    },
    "schemas": {
      "ErrorResponse": { "type": "object", "properties": { "error": {"type":"string"}, "details": {"type":"object"} } },
      "AuthLoginRequest": { "type": "object", "required": ["email","password"], "properties": { "email": {"type":"string","format":"email"}, "password": {"type":"string"} } },
      "AuthLoginResponse": { "type": "object", "properties": { "token": {"type":"string"}, "user": {"type":"object", "properties": {"id":{"type":"string"}, "email":{"type":"string"}, "name":{"type":"string"}} } } },
      "Customer": { "type": "object", "properties": { "id": {"type":"string"}, "name": {"type":"string"}, "email": {"type":"string","format":"email"}, "phone": {"type":"string"}, "createdAt": {"type":"string","format":"date-time"} }, "required": ["id","name","email","createdAt"] },
      "CustomerCreate": { "type": "object", "required": ["name","email"], "properties": { "name": {"type":"string"}, "email": {"type":"string","format":"email"}, "phone": {"type":"string"} } },
      "CustomerUpdate": { "type": "object", "properties": { "name": {"type":"string"}, "email": {"type":"string","format":"email"}, "phone": {"type":"string"} } },
      "Product": { "type": "object", "properties": { "id": {"type":"string"}, "name": {"type":"string"}, "price": {"type":"number"}, "stock": {"type":"integer","nullable": true}, "createdAt": {"type":"string","format":"date-time"} }, "required": ["id","name","price","createdAt"] },
      "ProductCreate": { "type": "object", "required": ["name","price"], "properties": { "name": {"type":"string"}, "price": {"type":"number"}, "stock": {"type":"integer"} } },
      "ProductUpdate": { "type": "object", "properties": { "name": {"type":"string"}, "price": {"type":"number"}, "stock": {"type":"integer"} } },
      "SaleItem": { "type": "object", "properties": { "productId": {"type":"string"}, "quantity": {"type":"number"}, "unitPrice": {"type":"number"} }, "required": ["productId","quantity","unitPrice"] },
      "Sale": { "type": "object", "properties": { "id": {"type":"string"}, "customerId": {"type":"string"}, "items": {"type":"array","items": {"$ref":"#/components/schemas/SaleItem"}}, "total": {"type":"number"}, "date": {"type":"string","format":"date-time"}, "status": {"type":"string","enum":["confirmed","canceled"]}, "createdAt": {"type":"string","format":"date-time"} }, "required": ["id","customerId","items","total","date","status","createdAt"] },
      "SaleCreate": { "type": "object", "required": ["customerId","items"], "properties": { "customerId": {"type":"string"}, "items": {"type":"array","items": {"$ref":"#/components/schemas/SaleItem"}}, "date": {"type":"string","format":"date-time"} } },
      "SaleUpdate": { "type": "object", "properties": { "customerId": {"type":"string"}, "items": {"type":"array","items": {"$ref":"#/components/schemas/SaleItem"}}, "date": {"type":"string","format":"date-time"}, "status": {"type":"string","enum":["confirmed","canceled"]} } },
      "RevenueTotal": { "type": "object", "properties": { "total": {"type":"number"} }, "required": ["total"] },
      "RevenueRow": { "type": "object", "properties": { "period": {"type":"string"}, "total": {"type":"number"} }, "required": ["period","total"] }
    },
    "responses": {
      "Unauthorized": { "description": "Não autorizado", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
      "BadRequest": { "description": "Solicitação inválida", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
      "Conflict": { "description": "Conflito de dados", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
      "NotFound": { "description": "Recurso não encontrado", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
      "Unprocessable": { "description": "Regra de negócio impede operação", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
    }
  }
}
